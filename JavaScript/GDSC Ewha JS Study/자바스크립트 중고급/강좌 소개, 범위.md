# 엔진 관점의 핵심 키워드

엔진 처리는 크게 **해석**과 **실행**로 나눌 수 있다. 해석은 컴파일과 실행할 환경을 설정하는 것. 실행은 해석 단계에서 설정된 환경을 바탕으로 코드를 실행하는 것이다.

# Execution Context 형태

- book() 함수가 호출되면
    - show Function 오브젝트가 생성된다.
    - show의 [[Scope]]에 스코프를 설정한다.
        - [[]]는 엔진이 설정하는 프로퍼티를 뜻한다.
        - 스코프는 show 함수가 속한 영역을 뜻한다.
    - show() 함수가 호출되면 EC를 생성한다.
        - 함수 실행을 위한 Context 환경을 구축
            - 하나의 덩어리 안에서 함수가 실행될 수 있도록 하는 것

# 식별자 해결, 스코프 용도

## 식별자 해결(Identifier Resolution)

- 사용할 변수/함수를 결정하는 것
- 예: Point 변수
- 신속, 정확한 검색을 위해 스코프가 필요하다.

```jsx
var point = 100;
function getPoint() {
	var point = 200;
	return point;
};
var result = getPoint();
console.log(result);
// 실행 결과: 200
// getPoint() 스코프 내에서 point를 찾음
```

- 스코프에서 이름을 찾기 위해 스코프에 이름을 설정한다.
    - 값은 변경되지만 이름은 변경되지 않는다.
    - 식별자 해결 대상은 **이름**이다.

## 스코프 용도

- 스코프는 식별자 해결을 위한 수단, 방법이다.
    - **스코프가 목적이 아니다!**
- 식별자가 유일하면 스코프는 필요하지 않는다.
    - 하지만 유일하게 작성하는 것은 불가능하기 때문에 스코프가 필요하다.

## 스코프 체인, 스펙의 스코프 체인 사용

### ES3: Scope chain

- scope chain은 실행 콘텍스트와 관련이 있으며 식별자 해결을 위해 사용한다.
    - 이는 ES5와 같다. 다만 ES5는 스코프는 사용하지만 스코프 체인은 사용하지 않는다.
- scope chain은 식별자를 검색하기 위한 {name: value} 리스트이다.
- 함수가 호출되면 스코프를 생성하고 함수의 변수와 함수를 {name: value} 형태로 설정한다.
- 생성한 스코프를 스코프 체인에 연결하고 스코프 체인에서 식별자를 해결한다.
- **동적 처리**
- ES3의 실행 콘텍스트 환경
    - 스코프 체인
    - Activation Object

# Lexcial Environment

## 정적 환경

- function 키워드를 만나면
    - function 오브젝트를 생성하고
    - 스코프를 FO의 [[Scope]]에 설정한다.
    - 이것은 함수 밖의 스코프가 설정되는 것이다.
- 이 시점에서 스코프가 결정된다.
    - 이것이 Lexical Environment
- 함수가 호출되면 FO의 [[Scope]]를 실행 콘텍스트의 렉시컬 환경 컴포넌트의 외부 렉시컬 환경 참조에 설정한다.

## var 키워드 문제

- 함수에서 var 키워드를 사용하지 않고 변수를 선언하면 글로벌 오브젝트에 설정된다.
    - 이는 렉시컬 환경 구조에 맞지 않는다.
- ES5 해결 방법: “use strict”를 사용!
- ES6 해결 방법
    - let 변수, const 변수
    - 변수 자체에 스코프 제약을 둠

## 동적 환경

- 실행 시점에 스코프가 결정된다.
    - with문
    - eval() 함수
- with문은 strict 모드에서 에러가 발생한다.
- eval() 함수는 보안에 문제가 있다.

# Node.js 코드 형태

- 서버 프로그램 고려사항
    - 동접 10K
- JS는 싱글 스레드이다.
- Node.js에서 JS는 비동기 처리
- 이러한 환경에서는 Context 형태가 효율성이 높다.
    - ES5의 실행 콘텍스트는 Context 형태이다.
- 실행 콘텍스트에 최적화된 형태로 코드를 작성해야 하며, 이를 위해 엔진 처리를 이해할 필요가 있다.
